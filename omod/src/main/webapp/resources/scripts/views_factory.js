/**
 * Views manipulations.
 * Created by Tallevi12
 */

var mainJsonFile = {
    "Obsgroubs": [
        {
            "groupID": 1,
            "groupName": "Blood Cell Profile",
            "lastTakenDate": "12 May 2014",
            "observations": [
                {
                    "concept_name": "WBC",
                    "date": "12 May 2014",
                    "value_type": "type",
                    "value": 4.0,
                    "UnitsOfMeasurement": "k/cumm",
                    "minValue": 4.5,
                    "maxValue": 11,
                    "location": "Pharamcy"
                },
                {
                    "concept_name": "WBC",
                    "date": "12 May 2014",
                    "value_type": "type",
                    "value": 4.0,
                    "UnitsOfMeasurement": "k/cumm",
                    "minValue": 4.5,
                    "maxValue": 11,
                    "location": "Pharamcy"
                },
                {
                    "concept_name": "WBC",
                    "date": "12 May 2014",
                    "value_type": "type",
                    "value": 4.0,
                    "UnitsOfMeasurement": "k/cumm",
                    "minValue": 4.5,
                    "maxValue": 11,
                    "location": "Pharamcy"
                },
                {
                    "concept_name": "WBC",
                    "date": "12 May 2014",
                    "value_type": "type",
                    "value": 4.0,
                    "UnitsOfMeasurement": "k/cumm",
                    "minValue": 4.5,
                    "maxValue": 11,
                    "location": "Pharamcy"
                }
            ]
        },
        {
            "groupID": 2,
            "groupName": "Blood Cell Profile",
            "lastTakenDate": "12 May 2014",
            "observations": [
                {
                    "concept_name": "WBC",
                    "date": "12 May 2014",
                    "value_type": "type",
                    "value": 4.0,
                    "UnitsOfMeasurement": "k/cumm",
                    "minValue": 4.5,
                    "maxValue": 11,
                    "location": "Pharamcy"
                },
                {
                    "concept_name": "WBC",
                    "date": "12 May 2014",
                    "value_type": "type",
                    "value": 4.0,
                    "UnitsOfMeasurement": "k/cumm",
                    "minValue": 4.5,
                    "maxValue": 11,
                    "location": "Pharamcy"
                },
                {
                    "concept_name": "WBC",
                    "date": "12 May 2014",
                    "value_type": "type",
                    "value": 4.0,
                    "UnitsOfMeasurement": "k/cumm",
                    "minValue": 4.5,
                    "maxValue": 11,
                    "location": "Pharamcy"
                },
                {
                    "concept_name": "WBC",
                    "date": "12 May 2014",
                    "value_type": "type",
                    "value": 4.0,
                    "UnitsOfMeasurement": "k/cumm",
                    "minValue": 4.5,
                    "maxValue": 11,
                    "location": "Pharamcy"
                }
            ]
        },
        {
            "groupID": 3,
            "groupName": "Blood Cell Profile",
            "lastTakenDate": "12 May 2014",
            "observations": [
                {
                    "concept_name": "WBC",
                    "date": "12 May 2014",
                    "value_type": "type",
                    "value": 4.0,
                    "UnitsOfMeasurement": "k/cumm",
                    "minValue": 4.5,
                    "maxValue": 11,
                    "location": "Pharamcy"
                },
                {
                    "concept_name": "WBC",
                    "date": "12 May 2014",
                    "value_type": "type",
                    "value": 4.0,
                    "UnitsOfMeasurement": "k/cumm",
                    "minValue": 4.5,
                    "maxValue": 11,
                    "location": "Pharamcy"
                },
                {
                    "concept_name": "WBC",
                    "date": "12 May 2014",
                    "value_type": "type",
                    "value": 4.0,
                    "UnitsOfMeasurement": "k/cumm",
                    "minValue": 4.5,
                    "maxValue": 11,
                    "location": "Pharamcy"
                },
                {
                    "concept_name": "WBC",
                    "date": "12 May 2014",
                    "value_type": "type",
                    "value": 4.0,
                    "UnitsOfMeasurement": "k/cumm",
                    "minValue": 4.5,
                    "maxValue": 11,
                    "location": "Pharamcy"
                }
            ]
        },
        {
            "groupID": 4,
            "groupName": "Blood Cell Profile",
            "lastTakenDate": "12 May 2014",
            "observations": [
                {
                    "concept_name": "WBC",
                    "date": "12 May 2014",
                    "value_type": "type",
                    "value": 4.0,
                    "UnitsOfMeasurement": "k/cumm",
                    "minValue": 4.5,
                    "maxValue": 11,
                    "location": "Pharamcy"
                },
                {
                    "concept_name": "WBC",
                    "date": "12 May 2014",
                    "value_type": "type",
                    "value": 4.0,
                    "UnitsOfMeasurement": "k/cumm",
                    "minValue": 4.5,
                    "maxValue": 11,
                    "location": "Pharamcy"
                },
                {
                    "concept_name": "WBC",
                    "date": "12 May 2014",
                    "value_type": "type",
                    "value": 4.0,
                    "UnitsOfMeasurement": "k/cumm",
                    "minValue": 4.5,
                    "maxValue": 11,
                    "location": "Pharamcy"
                },
                {
                    "concept_name": "WBC",
                    "date": "12 May 2014",
                    "value_type": "type",
                    "value": 4.0,
                    "UnitsOfMeasurement": "k/cumm",
                    "minValue": 4.5,
                    "maxValue": 11,
                    "location": "Pharamcy"
                }
            ]
        },
        {
            "groupID": 5,
            "groupName": "Blood Cell Profile",
            "lastTakenDate": "12 May 2014",
            "observations": [
                {
                    "concept_name": "WBC",
                    "date": "12 May 2014",
                    "value_type": "type",
                    "value": 4.0,
                    "UnitsOfMeasurement": "k/cumm",
                    "minValue": 4.5,
                    "maxValue": 11,
                    "location": "Pharamcy"
                },
                {
                    "concept_name": "WBC",
                    "date": "12 May 2014",
                    "value_type": "type",
                    "value": 4.0,
                    "UnitsOfMeasurement": "k/cumm",
                    "minValue": 4.5,
                    "maxValue": 11,
                    "location": "Pharamcy"
                },
                {
                    "concept_name": "WBC",
                    "date": "12 May 2014",
                    "value_type": "type",
                    "value": 4.0,
                    "UnitsOfMeasurement": "k/cumm",
                    "minValue": 4.5,
                    "maxValue": 11,
                    "location": "Pharamcy"
                },
                {
                    "concept_name": "WBC",
                    "date": "12 May 2014",
                    "value_type": "type",
                    "value": 4.0,
                    "UnitsOfMeasurement": "k/cumm",
                    "minValue": 4.5,
                    "maxValue": 11,
                    "location": "Pharamcy"
                }
            ]
        }
    ]
};

var viewsFactory;
var doT;

viewsFactory = {

    result_row: doT.template('<div class="result_conainer"><div class="result_header">{{=it.head || \"\" }}</div><div class="result_body">{{=it.body || \"\" }}</div></div>')

}

function addAllSingleObs(obsJSON)
{
    console.log(obsJSON);
    var resultText='';
    var single_obsJSON=obsJSON.obs_singles;
    for(var i=0;i<single_obsJSON.length;i++){
        resultText+=addSingleObsToResults(single_obsJSON[i]);
    }
    document.getElementById('obsgroups_results').innerHTML+=resultText;
}

function addSingleObsToResults(obsJSON)
{
    var resultText = '';
    resultText+='<div class="obsgroup_wrap" onclick="load_single_detailed_obs('+obsJSON.observation_id+');">';
    resultText+='<div class="obsgroup_first_row">';
    resultText+='<h3 class="obsgroup_title">';
    resultText+=obsJSON.concept_name;
    resultText+='</h3>';
    resultText+='<span class="obsgroup_date">';
    resultText+=obsJSON.date;
    resultText+='</span>'
    resultText+='<div class="chart_serach_clear"></div>';
    resultText+='</div>';
    resultText+='</div>';
    return resultText;
}



function load_single_detailed_obs(){

}
function addAllObsGroups(obsJSON)
{
    var resultText='';
    var obsgroupJSON=obsJSON.Obsgroubs;
    for(var i=0;i<obsgroupJSON.length;i++){
        resultText+=addObsGroupToResults(obsgroupJSON[i]);
    }
    document.getElementById('obsgroups_results').innerHTML+=resultText;
}

function addObsGroupToResults(obsJSON)
{
    var resultText = '';
    resultText+='<div class="obsgroup_wrap" onclick="load_detailed_obs('+obsJSON.groupID+');">';
    resultText+='<div class="obsgroup_first_row">';
    resultText+='<h3 class="obsgroup_title">';
    resultText+=obsJSON.groupName;
    resultText+='</h3>';
    resultText+='<span class="obsgroup_date">';
    resultText+=obsJSON.lastTakenDate;
    resultText+='</span>'
    resultText+='<div class="chart_serach_clear"></div>';
    resultText+='</div>';
    resultText+=innerObservationsHTML(obsJSON.observations);
    resultText+='</div>';
    return resultText;
}

function innerObservationsHTML(obsJSON) {
    console.log('====innerObservationsHTML function======');
    var resultText='';
    resultText+='<div class="obsgroup_rows">';
    for(var i=0;i<obsJSON.length;i++){
        resultText+=single_obs_html(obsJSON[i]);
    }
    resultText+='</div>';
    return resultText;
}

function single_obs_html(obsJSON) {
    console.log('====single obs html function=========');
    var resultText='';
    resultText+='<div class="obsgroup_row">';
    resultText+='<div class="obsgroup_row_first_section inline">';
    resultText+=obsJSON.concept_name;
    resultText+='</div>';
    resultText+='<div class="obsgroup_row_sec_section inline">';
    resultText+=obsJSON.value + ' ' + obsJSON.UnitsOfMeasurement;
    resultText+='</div>';
    resultText+='<div class="obsgroup_row_trd_section inline">';
    resultText+='(' + obsJSON.minValue + ' - ' + obsJSON.maxValue + ')';
    resultText+='</div>';
    resultText+='</div>';
    return resultText;
}

function get_obs_by_id(id)
{
    var obsgroupJSON=mainJsonFile.Obsgroubs;
    for(var i=0;i<obsgroupJSON.length;i++){
        if(obsgroupJSON[i].groupID==id)
        {
            return obsgroupJSON[i];
        }
    }
    return -1;
}

function load_detailed_obs(obs_id)
{
    var obsJSON = get_obs_by_id(obs_id);
    var resultText='';
    resultText+='<div class="obsgroup_view">';
    resultText+='<h3 class="chartserach_center">';
    resultText+=obsJSON.groupName;
    resultText+='</h3>';
    resultText+='<div class="obsgroup_all_wrapper">';
    var singleObs = obsJSON.observations;
    for(var i=0;i<singleObs.length;i++){
        resultText+='<div class="obsgroup_item_row">';
        resultText+='<div class="obsgroup_item_first inline">';
        resultText+=singleObs[i].concept_name;
        resultText+='</div>';
        resultText+='<div class="obsgroup_item_sec inline">';
        resultText+=singleObs[i].value +" "+ singleObs[i].UnitsOfMeasurement;
        resultText+='</div>';
        resultText+='<div class="obsgroup_item_trd inline">';
        resultText+=singleObs[i].location;
        resultText+='</div>';
        resultText+='<div class="obsgroup_item_frth inline">';
        resultText+=singleObs[i].date;
        resultText+'</div>';
        resultText+='</div>';
    }
    resultText+='</div>';
    resultText+='</div>';
    document.getElementById('obsgroup_view').innerHTML+=resultText;
}


/*
var resultJSON =' {"obs_groups":[],"obs_singles":[{"observation_id":18,"concept_name":"Pulse","date":"28/04/14","value_type":"Numeric","units_of_measurement":"rate/min","absolute_high":230,"absolute_low":0,"value":"28.0","location":"Registration Desk"},{"observation_id":27,"concept_name":"SYSTOLIC BLOOD PRESSURE","date":"28/04/14","value_type":"Numeric","units_of_measurement":"mmHg","absolute_high":250,"absolute_low":0,"value":"80.0","location":"Registration Desk"},{"observation_id":12,"concept_name":"Blood oxygen saturation","date":"23/04/14","value_type":"Numeric","units_of_measurement":"%","absolute_high":100,"absolute_low":0,"value":"32.0","location":"Laboratory"},{"observation_id":13,"concept_name":"DIASTOLIC BLOOD PRESSURE","date":"23/04/14","value_type":"Numeric","units_of_measurement":"mmHg","absolute_high":150,"absolute_low":0,"value":"100.0","location":"Laboratory"},{"observation_id":14,"concept_name":"Height (cm)","date":"23/04/14","value_type":"Numeric","units_of_measurement":"cm","absolute_high":228,"absolute_low":10,"value":"170.0","location":"Laboratory"},{"observation_id":30,"concept_name":"Respiratory rate","date":"28/04/14","value_type":"Numeric","units_of_measurement":"","value":"23.0","location":"Registration Desk"},{"observation_id":8,"concept_name":"DIASTOLIC BLOOD PRESSURE","date":"20/03/14","value_type":"Numeric","units_of_measurement":"mmHg","absolute_high":150,"absolute_low":0,"value":"120.0","location":"Laboratory"},{"observation_id":9,"concept_name":"Pulse","date":"23/04/14","value_type":"Numeric","units_of_measurement":"rate/min","absolute_high":230,"absolute_low":0,"value":"80.0","location":"Laboratory"},{"observation_id":25,"concept_name":"Blood oxygen saturation","date":"28/04/14","value_type":"Numeric","units_of_measurement":"%","absolute_high":100,"absolute_low":0,"value":"20.0","location":"Registration Desk"},{"observation_id":11,"concept_name":"Weight (kg)","date":"23/04/14","value_type":"Numeric","units_of_measurement":"kg","absolute_high":250,"absolute_low":0,"value":"80.0","location":"Laboratory"},{"observation_id":6,"concept_name":"Pulse","date":"20/03/14","value_type":"Numeric","units_of_measurement":"rate/min","absolute_high":230,"absolute_low":0,"value":"80.0","location":"Laboratory"},{"observation_id":7,"concept_name":"Height (cm)","date":"20/03/14","value_type":"Numeric","units_of_measurement":"cm","absolute_high":228,"absolute_low":10,"value":"170.0","location":"Laboratory"},{"observation_id":24,"concept_name":"Temperature (C)","date":"28/04/14","value_type":"Numeric","units_of_measurement":"DEG C","absolute_high":43,"absolute_low":25,"value":"27.0","location":"Registration Desk"},{"observation_id":17,"concept_name":"SYSTOLIC BLOOD PRESSURE","date":"28/04/14","value_type":"Numeric","units_of_measurement":"mmHg","absolute_high":250,"absolute_low":0,"value":"89.0","location":"Registration Desk"},{"observation_id":26,"concept_name":"Pulse","date":"28/04/14","value_type":"Numeric","units_of_measurement":"rate/min","absolute_high":230,"absolute_low":0,"value":"23.0","location":"Registration Desk"},{"observation_id":2,"concept_name":"Temperature (C)","date":"20/03/14","value_type":"Numeric","units_of_measurement":"DEG C","absolute_high":43,"absolute_low":25,"value":"36.0","location":"Laboratory"},{"observation_id":1,"concept_name":"Blood oxygen saturation","date":"20/03/14","value_type":"Numeric","units_of_measurement":"%","absolute_high":100,"absolute_low":0,"value":"10.0","location":"Laboratory"},{"observation_id":28,"concept_name":"DIASTOLIC BLOOD PRESSURE","date":"28/04/14","value_type":"Numeric","units_of_measurement":"mmHg","absolute_high":150,"absolute_low":0,"value":"120.0","location":"Registration Desk"},{"observation_id":20,"concept_name":"Weight (kg)","date":"28/04/14","value_type":"Numeric","units_of_measurement":"kg","absolute_high":250,"absolute_low":0,"value":"189.0","location":"Registration Desk"},{"observation_id":5,"concept_name":"Respiratory rate","date":"20/03/14","value_type":"Numeric","units_of_measurement":"","value":"80.0","location":"Laboratory"},{"observation_id":4,"concept_name":"SYSTOLIC BLOOD PRESSURE","date":"20/03/14","value_type":"Numeric","units_of_measurement":"mmHg","absolute_high":250,"absolute_low":0,"value":"80.0","location":"Laboratory"},{"observation_id":15,"concept_name":"Temperature (C)","date":"23/04/14","value_type":"Numeric","units_of_measurement":"DEG C","absolute_high":43,"absolute_low":25,"value":"30.0","location":"Laboratory"},{"observation_id":23,"concept_name":"Height (cm)","date":"28/04/14","value_type":"Numeric","units_of_measurement":"cm","absolute_high":228,"absolute_low":10,"value":"29.0","location":"Registration Desk"},{"observation_id":32,"concept_name":"Weight (kg)","date":"28/04/14","value_type":"Numeric","units_of_measurement":"kg","absolute_high":250,"absolute_low":0,"value":"20.0","location":"Registration Desk"},{"observation_id":10,"concept_name":"SYSTOLIC BLOOD PRESSURE","date":"23/04/14","value_type":"Numeric","units_of_measurement":"mmHg","absolute_high":250,"absolute_low":0,"value":"80.0","location":"Laboratory"},{"observation_id":3,"concept_name":"Weight (kg)","date":"20/03/14","value_type":"Numeric","units_of_measurement":"kg","absolute_high":250,"absolute_low":0,"value":"80.0","location":"Laboratory"},{"observation_id":19,"concept_name":"DIASTOLIC BLOOD PRESSURE","date":"28/04/14","value_type":"Numeric","units_of_measurement":"mmHg","absolute_high":150,"absolute_low":0,"value":"89.0","location":"Registration Desk"},{"observation_id":29,"concept_name":"Height (cm)","date":"28/04/14","value_type":"Numeric","units_of_measurement":"cm","absolute_high":228,"absolute_low":10,"value":"20.0","location":"Registration Desk"},{"observation_id":21,"concept_name":"Blood oxygen saturation","date":"28/04/14","value_type":"Numeric","units_of_measurement":"%","absolute_high":100,"absolute_low":0,"value":"89.0","location":"Registration Desk"},{"observation_id":22,"concept_name":"Respiratory rate","date":"28/04/14","value_type":"Numeric","units_of_measurement":"","value":"82.0","location":"Registration Desk"},{"observation_id":16,"concept_name":"Respiratory rate","date":"23/04/14","value_type":"Numeric","units_of_measurement":"","value":"80.0","location":"Laboratory"},{"observation_id":31,"concept_name":"Temperature (C)","date":"28/04/14","value_type":"Numeric","units_of_measurement":"DEG C","absolute_high":43,"absolute_low":25,"value":"35.0","location":"Registration Desk"}]} ';
*/


